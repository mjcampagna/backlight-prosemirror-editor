<!DOCTYPE html>
<html>
<head>
  <title>Tagfilter Test</title>
  <script type="module">
    import { createMarkdownSystem } from './src/markdownSystem.js';
    import { tagfilterExtension, createTagfilterTextProcessingPlugin } from './src/extensions/tagfilter.js';

    // Create system with tagfilter
    const system = createMarkdownSystem([tagfilterExtension], {
      textProcessing: createTagfilterTextProcessingPlugin()
    });

    // Test markdown with dangerous HTML
    const testMarkdown = `# Test Tagfilter

This has a safe <div>element</div> and a dangerous <script>alert("xss")</script> tag.

<iframe src="evil.com">Evil iframe</iframe>

<style>body { display: none; }</style>

Regular **markdown** still works.`;

    console.log('Original markdown:', testMarkdown);
    
    const doc = system.mdParser.parse(testMarkdown);
    const result = system.mdSerializer.serialize(doc);
    
    console.log('Filtered result:', result);
    
    // Check if dangerous tags are filtered
    const hasFilteredScript = result.includes('&lt;script>');
    const hasFilteredIframe = result.includes('&lt;iframe>');
    const hasFilteredStyle = result.includes('&lt;style>');
    const hasSafeDiv = result.includes('<div>element</div>');
    
    document.body.innerHTML = `
      <h1>Tagfilter Test Results</h1>
      <h2>Original:</h2>
      <pre>${testMarkdown}</pre>
      <h2>Filtered Result:</h2>
      <pre>${result}</pre>
      <h2>Tests:</h2>
      <ul>
        <li>Script tag filtered: ${hasFilteredScript ? '✅' : '❌'}</li>
        <li>Iframe tag filtered: ${hasFilteredIframe ? '✅' : '❌'}</li>
        <li>Style tag filtered: ${hasFilteredStyle ? '✅' : '❌'}</li>
        <li>Safe div preserved: ${hasSafeDiv ? '✅' : '❌'}</li>
      </ul>
    `;
  </script>
</head>
<body>
  Loading...
</body>
</html>
